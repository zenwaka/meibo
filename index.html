<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>若手市議会議員の会 議員名簿</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin:0; background:#f7f7f9; font-family:system-ui,"Noto Sans JP",sans-serif; }
    .container { max-width:1120px; margin:0 auto; padding:24px 16px; }
    h1 { font-size:1.6rem; margin-bottom:12px; }
    .toolbar { display:grid; grid-template-columns:1.3fr 1fr 1fr 1fr 1fr; gap:12px; margin-bottom:16px; }
    .field { display:flex; flex-direction:column; gap:6px; }
    .field label { font-size:0.9rem; color:#666; }
    input[type="text"], select { padding:10px 12px; border:1px solid #ccc; border-radius:8px; font-size:0.95rem; }
    .count { margin:8px 0 16px; color:#666; font-size:0.95rem; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px; }
    .card { background:#fff; border:1px solid #ddd; border-radius:12px; overflow:hidden; display:flex; flex-direction:column; }
    .card-header { aspect-ratio:1/1; width:100%; background:#fafafa; overflow:hidden; }
    .card-header img { width:100%; height:100%; object-fit:cover; object-position:top; display:block; }
    .card-body { padding:12px 14px; display:flex; flex-direction:column; gap:8px; }
    .name-row { display:flex; flex-direction:column; align-items:flex-start; gap:2px; }
    .kana { font-size:0.8rem; color:#666; line-height:1.2; }
    .name { font-weight:600; font-size:1.1rem; }
    .meta-row { display:flex; gap:12px; font-size:0.95rem; color:#555; flex-wrap:wrap; }
    .detail { display:grid; grid-template-columns:auto 1fr; column-gap:8px; row-gap:4px; font-size:0.95rem; }
    .detail dt { font-weight:600; color:#555; margin:0; }
    .detail dd { margin:0; color:#333; }
    .no-image {
      width:100%;
      height:100%;
      background:#eee;
      color:#999;
      font-size:0.9rem;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:bold;
    }
    .footer { padding:10px 14px; border-top:1px solid #eee; display:flex; flex-wrap:wrap; gap:6px; }
    .badge { border:1px solid #ccc; border-radius:999px; padding:2px 8px; font-size:0.85rem; color:#555; background:#fff; }
    .empty { text-align:center; color:#777; padding:32px 0; display:none; }
    @media (max-width:860px){ .toolbar{grid-template-columns:1fr 1fr 1fr;} }
    @media (max-width:560px){ .toolbar{grid-template-columns:1fr;} }
  </style>
</head>
<body>
<div class="container">
  <h1>若手市議会議員の会 議員名簿</h1>

  <div class="toolbar">
    <div class="field"><label>名前検索</label><input id="q" type="text"></div>
    <div class="field"><label>所属ブロック</label><select id="block"><option value="">すべて</option></select></div>
    <div class="field"><label>都道府県</label><select id="pref"><option value="">すべて</option></select></div>
    <div class="field"><label>所属政党</label><select id="party"><option value="">すべて</option></select></div>
    <div class="field">
      <label>並び替え</label>
      <select id="sort">
        <option value="">指定なし</option>
        <option value="ageAsc">年齢順（若い順）</option>
        <option value="ageDesc">年齢順（高い順）</option>
      </select>
    </div>
  </div>

  <div id="count" class="count"></div>
  <div id="grid" class="grid"></div>
  <div id="empty" class="empty">条件に一致する議員がいません。</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
const CSV_URL = "（CSVのURL）";

const F = {
  name: "名前",
  kana: "ふりがな",
  pref: "都道府県",
  block: "所属ブロック",
  council: "所属議会",
  party: "所属政党",
  birthday: "誕生日",
  firstWon: "初当選年月日",
  nextElection: "次回改選年月日",
  address: "住所",
  tel: "電話番号",
  fax: "FAX",
  email: "メールアドレス",
  photo: "HP掲載用写真",
  publish: "掲載判定",

  addressOpen: "住所公開",
  telOpen: "電話番号公開",
  birthdayOpen: "誕生日公開",
  emailOpen: "メールアドレス公開"
};

const toSafe = s => (s ?? "").toString().trim();
const escapeHtml = s => toSafe(s).replace(/[&<>"']/g, c =>
  ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])
);
const isOpen = v => toSafe(v) === "する";

const parseDateLoose = s => {
  const t = toSafe(s);
  if(!t) return null;
  const d = new Date(t.replace(/年|月/g,"/").replace(/日/g,""));
  return isNaN(d) ? null : d;
};
const calcAge = b => {
  const d = parseDateLoose(b);
  if(!d) return "";
  const t = new Date();
  let a = t.getFullYear() - d.getFullYear();
  if(t < new Date(t.getFullYear(), d.getMonth(), d.getDate())) a--;
  return a;
};

let rawData=[], filtered=[];

function renderGrid(){
  const grid=document.getElementById("grid");
  grid.innerHTML="";
  filtered.forEach(m=>{
    const age = isOpen(m[F.birthdayOpen]) ? calcAge(m[F.birthday]) : "";
    grid.insertAdjacentHTML("beforeend",`
      <div class="card">
        <div class="card-header">
          ${m[F.photo] ? `<img src="${escapeHtml(m[F.photo])}">` : `<div class="no-image">NO IMAGE</div>`}
        </div>
        <div class="card-body">
          <div class="name-row">
            <div class="kana">${escapeHtml(m[F.kana])}</div>
            <div class="name">${escapeHtml(m[F.name])}</div>
          </div>
          <div class="meta-row">
            ${age ? `<div>年齢: ${age}</div>` : ""}
            <div>${escapeHtml(m[F.council])}（${escapeHtml(m[F.pref])}）</div>
          </div>
          <dl class="detail">
            ${isOpen(m[F.birthdayOpen]) ? `<dt>誕生日</dt><dd>${escapeHtml(m[F.birthday])}</dd>` : ""}
            <dt>初当選</dt><dd>${escapeHtml(m[F.firstWon])}</dd>
            <dt>次回改選</dt><dd>${escapeHtml(m[F.nextElection])}</dd>
            ${isOpen(m[F.addressOpen]) ? `<dt>住所</dt><dd>${escapeHtml(m[F.address])}</dd>` : ""}
            ${isOpen(m[F.telOpen]) ? `<dt>電話</dt><dd>${escapeHtml(m[F.tel])}</dd>` : ""}
            ${isOpen(m[F.emailOpen]) ? `<dt>メール</dt><dd>${escapeHtml(m[F.email])}</dd>` : ""}
          </dl>
        </div>
      </div>
    `);
  });
}

async function main(){
  const text = await (await fetch(CSV_URL)).text();
  rawData = Papa.parse(text,{header:true}).data;
  filtered = rawData.filter(m => toSafe(m[F.publish]) === "掲載");
  renderGrid();
}
main();
</script>
</body>
</html>
